<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) - Google Analytics 4 -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://use.typekit.net">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XQERBRFEC9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XQERBRFEC9');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title }} by Jeffrey Veen</title>
    <meta name="description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeffrey Veen's blog about design, technology, and the web{% endif %}">
    <meta name="author" content="Jeffrey Veen">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeffrey Veen's blog about design, technology, and the web{% endif %}">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta name="twitter:title" content="{{ page.title }}">
    <meta name="twitter:description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeffrey Veen's blog about design, technology, and the web{% endif %}">
    <link rel="stylesheet" href="{{ site.url }}/jeff/css/style.css" type="text/css" media="screen">
    <link rel="stylesheet" href="https://use.typekit.net/hke3ona.css">
    <link rel="alternate" type="application/atom+xml" href="{{ site.url }}/rss-source.xml" title="Atom Feed">
  </head>
  <body>
    <div class="site">
      <header class="site-header">
        <nav class="site-nav" aria-label="Primary navigation">
            <p>
              <a href="{{site.url}}/jeff">Jeffrey Veen</a> &raquo; &nbsp; <a href="{{site.url}}/jeff">Blog</a> &nbsp; <a href="{{site.url}}/jeff/about/">About</a> &nbsp;
              <button class="theme-toggle" type="button" aria-label="Toggle color theme" aria-pressed="false">
                <span class="theme-toggle__icon" aria-hidden="true">◐</span>
              </button>
            </p>
        </nav>
      </header>

      <main class="site-main">
  		{{ content }}
      </main>
    </div>

    <script>
      (function () {
        const storageKey = "theme-preference";
        const root = document.documentElement;
        const toggle = document.querySelector(".theme-toggle");
        if (!toggle) return;

        const icon = toggle.querySelector(".theme-toggle__icon");
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)");

        const safeGet = () => {
          try {
            return localStorage.getItem(storageKey);
          } catch (error) {
            return null;
          }
        };

        const safeSet = (value) => {
          try {
            localStorage.setItem(storageKey, value);
          } catch (error) {
            /* ignore write failures, e.g. private mode */
          }
        };

        const applyTheme = (theme) => {
          const isDark = theme === "dark";
          root.classList.remove("theme--dark", "theme--light");
          root.classList.add(isDark ? "theme--dark" : "theme--light");
          toggle.setAttribute("aria-pressed", String(isDark));
          if (icon) {
            icon.textContent = isDark ? "◑" : "◐";
          }
        };

        const getPreferredTheme = () => {
          const stored = safeGet();
          if (stored === "dark" || stored === "light") {
            return stored;
          }
          return prefersDark && prefersDark.matches ? "dark" : "light";
        };

        let currentTheme = getPreferredTheme();
        applyTheme(currentTheme);

        toggle.addEventListener("click", () => {
          currentTheme = currentTheme === "dark" ? "light" : "dark";
          applyTheme(currentTheme);
          safeSet(currentTheme);
        });

        const handlePreferenceChange = (event) => {
          if (safeGet()) {
            return;
          }
          currentTheme = event.matches ? "dark" : "light";
          applyTheme(currentTheme);
        };

        if (prefersDark && prefersDark.addEventListener) {
          prefersDark.addEventListener("change", handlePreferenceChange);
        } else if (prefersDark && prefersDark.addListener) {
          prefersDark.addListener(handlePreferenceChange);
        }
      })();
    </script>
  </body>
</html>
