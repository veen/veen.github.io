<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) - Google Analytics 4 -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://use.typekit.net">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XQERBRFEC9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XQERBRFEC9');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title }}</title>
    <meta name="description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeff Veen's blog about design, technology, and the web{% endif %}">
    <meta name="author" content="Jeff Veen">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeff Veen's blog about design, technology, and the web{% endif %}">
    {% if page.og_image %}
    <meta property="og:image" content="{{ site.url }}{{ page.og_image }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {% endif %}

    <!-- Twitter -->
    <meta name="twitter:card" content="{% if page.og_image %}summary_large_image{% else %}summary{% endif %}">
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta name="twitter:title" content="{{ page.title }}">
    <meta name="twitter:description" content="{% if page.abstract %}{{ page.abstract }}{% else %}Jeff Veen's blog about design, technology, and the web{% endif %}">
    {% if page.og_image %}
    <meta name="twitter:image" content="{{ site.url }}{{ page.og_image }}">
    {% endif %}
    
    <script>
      (function () {
        const storageKey = "theme-preference";
        try {
          const stored = localStorage.getItem(storageKey);
          const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)");
          if (stored === "dark" || stored === "light") {
            document.documentElement.dataset.theme = stored;
          } else if (prefersDark && prefersDark.matches) {
            document.documentElement.dataset.theme = "dark";
          }
        } catch (error) {
          /* ignore failures (private mode, etc.) */
        }
      })();
    </script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="{{ '/jeff/css/style.css' | relative_url }}" type="text/css" media="screen">

    <!-- My baby... -->
    <link rel="stylesheet" href="https://use.typekit.net/hke3ona.css">

    <!-- Prism syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-light-theme">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" id="prism-dark-theme" disabled>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css">

    <link rel="alternate" type="application/atom+xml" href="{{ '/jeff/rss-source.xml' | absolute_url }}" title="Atom Feed">
    <link
      rel="stylesheet"
      href="https://unpkg.com/littlefoot/dist/littlefoot.css"
    >
    <script defer src="https://unpkg.com/littlefoot/dist/littlefoot.js"></script>
  </head>
  <body>
    <a class="sr-only" href="#main-content">Skip to main content</a>
    <div class="page">
      <nav class="site-header site-nav" aria-label="Primary navigation">
          <ul class="site-nav__list">
            <li class="site-nav__item site-nav__item--home">
              <a href="{{ '/jeff' | relative_url }}">Jeff Veen</a>
            </li>
            <li class="site-nav__item">
              <a href="{{ '/jeff' | relative_url }}">Blog</a>
            </li>
            <li class="site-nav__item">
              <a href="{{ '/jeff/about/' | relative_url }}">About</a>
            </li>
            <li class="site-nav__item site-nav__item--theme">
              <button class="theme-toggle" type="button" aria-label="Toggle color theme" aria-pressed="false">
                <span class="theme-toggle__icon" aria-hidden="true">◐</span>
              </button>
            </li>
          </ul>
      </nav>

      <main class="content" id="main-content">
		{{ content }}
      </main>
    </div>

    <script>
      (function () {
        const storageKey = "theme-preference";
        const root = document.documentElement;
        const toggle = document.querySelector(".theme-toggle");
        if (!toggle) return;

        const icon = toggle.querySelector(".theme-toggle__icon");
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)");

        const safeGet = () => {
          try {
            return localStorage.getItem(storageKey);
          } catch (error) {
            return null;
          }
        };

        const safeSet = (value) => {
          try {
            localStorage.setItem(storageKey, value);
          } catch (error) {
            /* ignore write failures, e.g. private mode */
          }
        };

        const syncPrismThemes = (isDark) => {
          const lightTheme = document.getElementById("prism-light-theme");
          const darkTheme = document.getElementById("prism-dark-theme");
          if (lightTheme && darkTheme) {
            lightTheme.disabled = isDark;
            darkTheme.disabled = !isDark;
          }
        };

        const updateToggleState = (isDark) => {
          toggle.setAttribute("aria-pressed", String(isDark));
          toggle.setAttribute("aria-label", isDark ? "Switch to light theme" : "Switch to dark theme");
          toggle.setAttribute("title", isDark ? "Switch to light theme" : "Switch to dark theme");
          if (icon) {
            icon.textContent = isDark ? "◑" : "◐";
          }
        };

        const resolveTheme = (theme) => {
          if (theme === "dark" || theme === "light") {
            return theme;
          }
          return prefersDark && prefersDark.matches ? "dark" : "light";
        };

        const announceTheme = (isDark) => {
          let liveRegion = document.getElementById("theme-status");
          if (!liveRegion) {
            liveRegion = document.createElement("div");
            liveRegion.id = "theme-status";
            liveRegion.setAttribute("aria-live", "polite");
            liveRegion.setAttribute("class", "sr-only");
            document.body.appendChild(liveRegion);
          }
          liveRegion.textContent = isDark ? "Dark theme enabled" : "Light theme enabled";
        };

        const applyTheme = (theme) => {
          const finalTheme = resolveTheme(theme);
          root.dataset.theme = finalTheme;
          const isDark = finalTheme === "dark";
          updateToggleState(isDark);
          syncPrismThemes(isDark);
          announceTheme(isDark);
        };

        const syncFromPreference = () => {
          const stored = safeGet();
          if (stored === "dark" || stored === "light") {
            applyTheme(stored);
          } else {
            applyTheme(null);
          }
        };

        const currentTheme = () => root.dataset.theme || resolveTheme(null);

        syncFromPreference();

        toggle.addEventListener("click", () => {
          const nextTheme = currentTheme() === "dark" ? "light" : "dark";
          applyTheme(nextTheme);
          safeSet(nextTheme);
        });

        const handlePreferenceChange = () => {
          if (safeGet()) {
            return;
          }
          applyTheme(null);
        };

        if (prefersDark && prefersDark.addEventListener) {
          prefersDark.addEventListener("change", handlePreferenceChange);
        } else if (prefersDark && prefersDark.addListener) {
          prefersDark.addListener(handlePreferenceChange);
        }
      })();
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (window.littlefoot) {
          const initializer = window.littlefoot.default || window.littlefoot;
          if (typeof initializer === "function") {
            initializer();
          }
        }
      });
    </script>

    <!-- Prism syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
  </body>
</html>
